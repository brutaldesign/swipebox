/**
 * Swipebox - A touchable jQuery lightbox
 *
 * @author Constantin Saguin - @brutaldesign
 * @link  http://csag.co
 * @github http://github.com/brutaldesign/swipebox
 * @version 1.2.3
 * @license MIT License
*/
;(function(t,n,r,i){r.swipebox=function(s,o){var u={useCSS:true,initialIndexOnArray:0,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null},a=this,f=[],l=s.selector,c=r(l),h=n.createTouch!==i||"ontouchstart"in t||"onmsgesturechange"in t||navigator.msMaxTouchPoints,p=!!t.SVGSVGElement,d=t.innerWidth?t.innerWidth:r(t).width(),v=t.innerHeight?t.innerHeight:r(t).height(),m='<div id="swipebox-overlay">				<div id="swipebox-slider"></div>				<div id="swipebox-caption"></div>				<div id="swipebox-action">					<a id="swipebox-close"></a>					<a id="swipebox-prev"></a>					<a id="swipebox-next"></a>				</div>		</div>';a.settings={};a.init=function(){a.settings=r.extend({},u,o);if(r.isArray(s)){f=s;g.target=r(t);g.init(a.settings.initialIndexOnArray)}else{r(n).on("click",l,function(e){a.refresh();f=[];var t,n,i;if(!i){n="rel";i=r(this).attr(n)}if(i&&i!==""&&i!=="nofollow"){$elem=c.filter("["+n+'="'+i+'"]')}else{$elem=r(l)}$elem.each(function(){var e=null,t=null;if(r(this).attr("title"))e=r(this).attr("title");if(r(this).attr("href"))t=r(this).attr("href");f.push({href:t,title:e})});t=$elem.index(r(this));e.preventDefault();e.stopPropagation();g.target=r(e.target);g.init(t)})}};a.refresh=function(){if(!r.isArray(s)){g.destroy();$elem=r(l);g.actions()}};var g={init:function(e){if(a.settings.beforeOpen)a.settings.beforeOpen();this.target.trigger("swipebox-start");r.swipebox.isOpen=true;this.build();this.openSlide(e);this.openMedia(e);this.preloadMedia(e+1);this.preloadMedia(e-1)},build:function(){var e=this;r("body").append(m);if(e.doCssTrans()){r("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"});r("#swipebox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"});r("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})}if(p){var t=r("#swipebox-action #swipebox-close").css("background-image");t=t.replace("png","svg");r("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":t})}r.each(f,function(){r("#swipebox-slider").append('<div class="slide"></div>')});e.setDim();e.actions();e.keyboard();e.gesture();e.animBars();e.resize()},setDim:function(){var e,n,i={};if("onorientationchange"in t){t.addEventListener("orientationchange",function(){if(t.orientation===0){e=d;n=v}else if(t.orientation===90||t.orientation===-90){e=v;n=d}},false)}else{e=t.innerWidth?t.innerWidth:r(t).width();n=t.innerHeight?t.innerHeight:r(t).height()}i={width:e,height:n};r("#swipebox-overlay").css(i)},resize:function(){var e=this;r(t).resize(function(){e.setDim()}).resize()},supportTransition:function(){var e="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(var t=0;t<e.length;t++){if(n.createElement("div").style[e[t]]!==i){return e[t]}}return false},doCssTrans:function(){if(a.settings.useCSS&&this.supportTransition()){return true}},gesture:function(){if(h){var t=this,n=null,i=10,s={},o={},u=r("#swipebox-caption, #swipebox-action");u.addClass("visible-bars");t.setTimeout();r("body").bind("touchstart",function(t){r(this).addClass("touching");o=t.originalEvent.targetTouches[0];s.pageX=t.originalEvent.targetTouches[0].pageX;r(".touching").bind("touchmove",function(t){t.preventDefault();t.stopPropagation();o=e.originalEvent.targetTouches[0]});return false}).bind("touchend",function(e){e.preventDefault();e.stopPropagation();n=o.pageX-s.pageX;if(n>=i){t.getPrev()}else if(n<=-i){t.getNext()}else{if(!u.hasClass("visible-bars")){t.showBars();t.setTimeout()}else{t.clearTimeout();t.hideBars()}}r(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(a.settings.hideBarsDelay>0){var e=this;e.clearTimeout();e.timeout=t.setTimeout(function(){e.hideBars()},a.settings.hideBarsDelay)}},clearTimeout:function(){t.clearTimeout(this.timeout);this.timeout=null},showBars:function(){var e=r("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){e.addClass("visible-bars")}else{r("#swipebox-caption").animate({top:0},500);r("#swipebox-action").animate({bottom:0},500);setTimeout(function(){e.addClass("visible-bars")},1e3)}},hideBars:function(){var e=r("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){e.removeClass("visible-bars")}else{r("#swipebox-caption").animate({top:"-50px"},500);r("#swipebox-action").animate({bottom:"-50px"},500);setTimeout(function(){e.removeClass("visible-bars")},1e3)}},animBars:function(){var e=this;var t=r("#swipebox-caption, #swipebox-action");t.addClass("visible-bars");e.setTimeout();r("#swipebox-slider").click(function(){if(!t.hasClass("visible-bars")){e.showBars();e.setTimeout()}});r("#swipebox-action").hover(function(){e.showBars();t.addClass("force-visible-bars");e.clearTimeout()},function(){t.removeClass("force-visible-bars");e.setTimeout()})},keyboard:function(){var e=this;r(t).bind("keyup",function(t){t.preventDefault();t.stopPropagation();if(t.keyCode===37){e.getPrev()}else if(t.keyCode===39){e.getNext()}else if(t.keyCode===27){e.closeSlide()}})},actions:function(){var e=this;if(f.length<2){r("#swipebox-prev, #swipebox-next").hide()}else{r("#swipebox-prev").bind("click touchend",function(t){t.preventDefault();t.stopPropagation();e.getPrev();e.setTimeout()});r("#swipebox-next").bind("click touchend",function(t){t.preventDefault();t.stopPropagation();e.getNext();e.setTimeout()})}r("#swipebox-close").bind("click touchend",function(){e.closeSlide()})},setSlide:function(e,t){t=t||false;var n=r("#swipebox-slider");if(this.doCssTrans()){n.css({left:-e*100+"%"})}else{n.animate({left:-e*100+"%"})}r("#swipebox-slider .slide").removeClass("current");r("#swipebox-slider .slide").eq(e).addClass("current");this.setTitle(e);if(t){n.fadeIn()}r("#swipebox-prev, #swipebox-next").removeClass("disabled");if(e===0){r("#swipebox-prev").addClass("disabled")}else if(e===f.length-1){r("#swipebox-next").addClass("disabled")}},openSlide:function(e){r("html").addClass("swipebox");r(t).trigger("resize");this.setSlide(e,true)},preloadMedia:function(e){var t=this,n=null;if(f[e]!==i)n=f[e].href;if(!t.isVideo(n)){setTimeout(function(){t.openMedia(e)},1e3)}else{t.openMedia(e)}},openMedia:function(e){var t=this,n=null;if(f[e]!==i)n=f[e].href;if(e<0||e>=f.length){return false}if(!t.isVideo(n)){t.loadMedia(n,function(){r("#swipebox-slider .slide").eq(e).html(this)})}else{r("#swipebox-slider .slide").eq(e).html(t.getVideo(n))}},setTitle:function(e,t){var n=null;r("#swipebox-caption").empty();if(f[e]!==i)n=f[e].title;if(n){r("#swipebox-caption").append(n)}},isVideo:function(e){if(e){if(e.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||e.match(/vimeo\.com\/([0-9]*)/)){return true}}},getVideo:function(e){var t="";var n="";var r=e.match(/watch\?v=([a-zA-Z0-9\-_]+)/);var i=e.match(/vimeo\.com\/([0-9]*)/);if(r){t='<iframe width="560" height="315" src="//www.youtube.com/embed/'+r[1]+'" frameborder="0" allowfullscreen></iframe>'}else if(i){t='<iframe width="560" height="315"  src="//player.vimeo.com/video/'+i[1]+"?byline=0&portrait=0&color="+a.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}return'<div class="swipebox-video-container" style="max-width:'+a.settings.videomaxWidth+'px"><div class="swipebox-video">'+t+"</div></div>"},loadMedia:function(e,t){if(!this.isVideo(e)){var n=r("<img>").on("load",function(){t.call(n)});n.attr("src",e)}},getNext:function(){var e=this;index=r("#swipebox-slider .slide").index(r("#swipebox-slider .slide.current"));if(index+1<f.length){index++;e.setSlide(index);e.preloadMedia(index+1)}else{r("#swipebox-slider").addClass("rightSpring");setTimeout(function(){r("#swipebox-slider").removeClass("rightSpring")},500)}},getPrev:function(){index=r("#swipebox-slider .slide").index(r("#swipebox-slider .slide.current"));if(index>0){index--;this.setSlide(index);this.preloadMedia(index-1)}else{r("#swipebox-slider").addClass("leftSpring");setTimeout(function(){r("#swipebox-slider").removeClass("leftSpring")},500)}},closeSlide:function(){r("html").removeClass("swipebox");r(t).trigger("resize");this.destroy()},destroy:function(){r(t).unbind("keyup");r("body").unbind("touchstart");r("body").unbind("touchmove");r("body").unbind("touchend");r("#swipebox-slider").unbind();r("#swipebox-overlay").remove();if(!r.isArray(s))s.removeData("_swipebox");if(this.target)this.target.trigger("swipebox-destroy");r.swipebox.isOpen=false;if(a.settings.afterClose)a.settings.afterClose()}};a.init()};r.fn.swipebox=function(e){if(!r.data(this,"_swipebox")){var t=new r.swipebox(this,e);this.data("_swipebox",t)}return this.data("_swipebox")}})(window,document,jQuery)
