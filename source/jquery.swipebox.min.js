/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link            http://csag.co
@github        http://github.com/brutaldesign/swipebox
@version     1.2.1
@license      MIT License

----------------------------------------------------------------------------------------------*/
(function(b,a,c,d){c.swipebox=function(h,r){var k={useCSS:true,initialIndexOnArray:0,hideBarsDelay:3000,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null,fullScreen:false,autoSwipeDelay:-1},o=this,e=[],h=h,i=h.selector,q=c(i),l=a.createTouch!==d||("ontouchstart" in b)||("onmsgesturechange" in b)||navigator.msMaxTouchPoints,m=!!(b.SVGSVGElement),g=b.innerWidth?b.innerWidth:c(b).width(),j=b.innerHeight?b.innerHeight:c(b).height(),n='<div id="swipebox-overlay">				<div id="swipebox-slider"></div>				<div id="swipebox-caption"></div>				<div id="swipebox-action">					<a id="swipebox-close"></a>					<a id="swipebox-prev"></a>					<a id="swipebox-next"></a>				</div>		</div>';var f;o.settings={};o.init=function(){o.settings=c.extend({},k,r);if(c.isArray(h)){e=h;p.target=c(b);p.init(o.settings.initialIndexOnArray)}else{q.click(function(u){e=[];var s,t,v;if(!v){t="rel";v=c(this).attr(t)}if(v&&v!==""&&v!=="nofollow"){$elem=q.filter("["+t+'="'+v+'"]')}else{$elem=c(i)}$elem.each(function(){var x=null,w=null;if(c(this).attr("title")){x=c(this).attr("title")}if(c(this).attr("href")){w=c(this).attr("href")}e.push({href:w,title:x})});s=$elem.index(c(this));u.preventDefault();u.stopPropagation();p.target=c(u.target);p.init(s)})}};o.refresh=function(){if(!c.isArray(h)){p.destroy();$elem=c(i);p.actions()}};var p={init:function(s){if(o.settings.beforeOpen){o.settings.beforeOpen()}this.target.trigger("swipebox-start");c.swipebox.isOpen=true;this.build();this.openSlide(s);this.openMedia(s);this.preloadMedia(s+1);this.preloadMedia(s-1)},build:function(){var u=this;c("body").append(n);if(u.doCssTrans()){c("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"});c("#swipebox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"});c("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})}if(m){var s=c("#swipebox-action #swipebox-close").css("background-image");s=s.replace("png","svg");c("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":s})}c.each(e,function(){c("#swipebox-slider").append('<div class="slide"></div>')});if(o.settings.fullScreen){var t=a.body;u.requestFullScreen(t)}u.setDim();u.actions();u.keyboard();u.gesture();u.animBars();u.resize()},requestFullScreen:function(s){var t=s.requestFullScreen||s.webkitRequestFullScreen||s.mozRequestFullScreen||s.msRequestFullScreen;if(t){t.call(s)}},exitFullScreen:function(s){var t=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullscreen;if(t){t.call(a)}},setDim:function(){var u,s,t={};if("onorientationchange" in b){b.addEventListener("orientationchange",function(){if(b.orientation==0){u=g;s=j}else{if(b.orientation==90||b.orientation==-90){u=j;s=g}}},false)}else{u=b.innerWidth?b.innerWidth:c(b).width();s=b.innerHeight?b.innerHeight:c(b).height()}t={width:u,height:s};c("#swipebox-overlay").css(t)},resize:function(){var s=this;c(b).resize(function(){s.setDim()}).resize()},supportTransition:function(){var t="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(var s=0;s<t.length;s++){if(a.createElement("div").style[t[s]]!==d){return t[s]}}return false},doCssTrans:function(){if(o.settings.useCSS&&this.supportTransition()){return true}},gesture:function(){if(l){var w=this,x=null,v=10,u={},s={};var t=c("#swipebox-caption, #swipebox-action");t.addClass("visible-bars");w.setTimeout();c("body").bind("touchstart",function(y){c(this).addClass("touching");s=y.originalEvent.targetTouches[0];u.pageX=y.originalEvent.targetTouches[0].pageX;c(".touching").bind("touchmove",function(z){z.preventDefault();z.stopPropagation();s=z.originalEvent.targetTouches[0]});return false}).bind("touchend",function(y){y.preventDefault();y.stopPropagation();x=s.pageX-u.pageX;if(x>=v){w.getPrev()}else{if(x<=-v){w.getNext()}else{if(!t.hasClass("visible-bars")){w.showBars();w.setTimeout()}else{w.clearTimeout();w.hideBars()}}}c(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(o.settings.hideBarsDelay>0){var s=this;s.clearTimeout();s.timeout=b.setTimeout(function(){s.hideBars()},o.settings.hideBarsDelay)}},clearTimeout:function(){b.clearTimeout(this.timeout);this.timeout=null},setAutoSwipeTimeout:function(){if(o.settings.autoSwipeDelay>0){var s=this;s.clearAutoSwipeTimeout();s.swipeTimerId=b.setTimeout(function(){s.getNext()},o.settings.autoSwipeDelay)}},clearAutoSwipeTimeout:function(){b.clearTimeout(this.swipeTimerId);this.swipeTimerId=null},showBars:function(){var s=c("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){s.addClass("visible-bars")}else{c("#swipebox-caption").animate({top:0},500);c("#swipebox-action").animate({bottom:0},500);setTimeout(function(){s.addClass("visible-bars")},1000)}},hideBars:function(){var s=c("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){s.removeClass("visible-bars")}else{c("#swipebox-caption").animate({top:"-50px"},500);c("#swipebox-action").animate({bottom:"-50px"},500);setTimeout(function(){s.removeClass("visible-bars")},1000)}},animBars:function(){var t=this;var s=c("#swipebox-caption, #swipebox-action");s.addClass("visible-bars");t.setTimeout();c("#swipebox-slider").click(function(u){if(!s.hasClass("visible-bars")){t.showBars();t.setTimeout()}});c("#swipebox-action").hover(function(){t.showBars();s.addClass("force-visible-bars");t.clearTimeout()},function(){s.removeClass("force-visible-bars");t.setTimeout()})},keyboard:function(){var s=this;c(b).bind("keyup",function(t){t.preventDefault();t.stopPropagation();if(t.keyCode==37){s.getPrev()}else{if(t.keyCode==39){s.getNext()}else{if(t.keyCode==27){s.closeSlide()}}}})},actions:function(){var s=this;if(e.length<2){c("#swipebox-prev, #swipebox-next").hide()}else{c("#swipebox-prev").bind("click touchend",function(t){t.preventDefault();t.stopPropagation();s.getPrev();s.setTimeout()});c("#swipebox-next").bind("click touchend",function(t){t.preventDefault();t.stopPropagation();s.getNext();s.setTimeout()})}c("#swipebox-close").bind("click touchend",function(t){s.closeSlide()})},setSlide:function(t,s){s=s||false;var u=c("#swipebox-slider");if(this.doCssTrans()){u.css({left:(-t*100)+"%"})}else{u.animate({left:(-t*100)+"%"})}c("#swipebox-slider .slide").removeClass("current");c("#swipebox-slider .slide").eq(t).addClass("current");this.setTitle(t);if(s){u.fadeIn()}this.clearAutoSwipeTimeout();this.setAutoSwipeTimeout();c("#swipebox-prev, #swipebox-next").removeClass("disabled");if(t==0){c("#swipebox-prev").addClass("disabled")}else{if(t==e.length-1){c("#swipebox-next").addClass("disabled");this.clearAutoSwipeTimeout()}}},openSlide:function(s){c("html").addClass("swipebox");c(b).trigger("resize");this.setSlide(s,true)},preloadMedia:function(s){var t=this,u=null;if(e[s]!==d){u=e[s].href}if(!t.isVideo(u)){setTimeout(function(){t.openMedia(s)},1000)}else{t.openMedia(s)}},openMedia:function(s){var t=this,u=null;if(e[s]!==d){u=e[s].href}if(s<0||s>=e.length){return false}if(!t.isVideo(u)){t.loadMedia(u,function(){c("#swipebox-slider .slide").eq(s).html(this)})}else{c("#swipebox-slider .slide").eq(s).html(t.getVideo(u))}t.clearAutoSwipeTimeout();t.setAutoSwipeTimeout()},setTitle:function(t,s){var u=null;c("#swipebox-caption").empty();if(e[t]!==d){u=e[t].title}if(u){c("#swipebox-caption").append(u)}},isVideo:function(s){if(s){if(s.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||s.match(/vimeo\.com\/([0-9]*)/)){return true}}},getVideo:function(u){var v="";var t="";var s=u.match(/watch\?v=([a-zA-Z0-9\-_]+)/);var w=u.match(/vimeo\.com\/([0-9]*)/);if(s){v='<iframe width="560" height="315" src="//www.youtube.com/embed/'+s[1]+'" frameborder="0" allowfullscreen></iframe>'}else{if(w){v='<iframe width="560" height="315"  src="http://player.vimeo.com/video/'+w[1]+"?byline=0&amp;portrait=0&amp;color="+o.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}}return'<div class="swipebox-video-container" style="max-width:'+o.settings.videomaxWidth+'px"><div class="swipebox-video">'+v+"</div></div>"},loadMedia:function(t,u){if(!this.isVideo(t)){var s=c("<img>").on("load",function(){u.call(s)});s.attr("src",t)}},getNext:function(){var s=this;index=c("#swipebox-slider .slide").index(c("#swipebox-slider .slide.current"));if(index+1<e.length){index++;s.setSlide(index);s.preloadMedia(index+1)}else{c("#swipebox-slider").addClass("rightSpring");setTimeout(function(){c("#swipebox-slider").removeClass("rightSpring")},500)}},getPrev:function(){index=c("#swipebox-slider .slide").index(c("#swipebox-slider .slide.current"));if(index>0){index--;this.setSlide(index);this.preloadMedia(index-1)}else{c("#swipebox-slider").addClass("leftSpring");setTimeout(function(){c("#swipebox-slider").removeClass("leftSpring")},500)}},closeSlide:function(){if(o.settings.fullScreen){this.exitFullScreen()}c("html").removeClass("swipebox");c(b).trigger("resize");this.destroy()},destroy:function(){this.clearAutoSwipeTimeout();c(b).unbind("keyup");c("body").unbind("touchstart");c("body").unbind("touchmove");c("body").unbind("touchend");c("#swipebox-slider").unbind();c("#swipebox-overlay").remove();if(!c.isArray(h)){h.removeData("_swipebox")}if(this.target){this.target.trigger("swipebox-destroy")}c.swipebox.isOpen=false;if(o.settings.afterClose){o.settings.afterClose()}}};o.init()};c.fn.swipebox=function(f){if(!c.data(this,"_swipebox")){var e=new c.swipebox(this,f);this.data("_swipebox",e)}return this.data("_swipebox")}}(window,document,jQuery));