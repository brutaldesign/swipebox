/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link            http://csag.co
@github        http://github.com/brutaldesign/swipebox
@version     1.2.1
@license      MIT License

----------------------------------------------------------------------------------------------*/
(function(b,a,c,d){c.swipebox=function(g,q){var j={useCSS:true,initialIndexOnArray:0,hideBarsDelay:3000,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null,fullScreen:false,autoSwipeDelay:-1},n=this,e=[],g=g,h=g.selector,p=c(h),k=a.createTouch!==d||("ontouchstart" in b)||("onmsgesturechange" in b)||navigator.msMaxTouchPoints,l=!!(b.SVGSVGElement),f=b.innerWidth?b.innerWidth:c(b).width(),i=b.innerHeight?b.innerHeight:c(b).height(),m='<div id="swipebox-overlay">				<div id="swipebox-slider"></div>				<div id="swipebox-caption"></div>				<div id="swipebox-action">					<a id="swipebox-close"></a>					<a id="swipebox-play"></a>					<a id="swipebox-prev"></a>					<a id="swipebox-next"></a>				</div>		</div>';n.settings={};n.init=function(){n.settings=c.extend({},j,q);if(n.settings.autoSwipeDelay>0){this.paused=false}else{this.paused=true}if(c.isArray(g)){e=g;o.target=c(b);o.init(n.settings.initialIndexOnArray)}else{p.click(function(t){e=[];var r,s,u;if(!u){s="rel";u=c(this).attr(s)}if(u&&u!==""&&u!=="nofollow"){$elem=p.filter("["+s+'="'+u+'"]')}else{$elem=c(h)}$elem.each(function(){var w=null,v=null;if(c(this).attr("title")){w=c(this).attr("title")}if(c(this).attr("href")){v=c(this).attr("href")}e.push({href:v,title:w})});r=$elem.index(c(this));t.preventDefault();t.stopPropagation();o.target=c(t.target);o.init(r)})}};n.refresh=function(){if(!c.isArray(g)){o.destroy();$elem=c(h);o.actions()}};var o={init:function(r){if(n.settings.beforeOpen){n.settings.beforeOpen()}this.target.trigger("swipebox-start");c.swipebox.isOpen=true;this.build();this.openSlide(r);this.openMedia(r);this.preloadMedia(r+1);this.preloadMedia(r-1)},build:function(){var t=this;c("body").append(m);if(this.paused){c("#swipebox-action #swipebox-play").addClass("play-button")}else{c("#swipebox-action #swipebox-play").addClass("pause-button")}if(t.doCssTrans()){c("#swipebox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"});c("#swipebox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"});c("#swipebox-action, #swipebox-caption").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})}if(l){var r=c("#swipebox-action #swipebox-close").css("background-image");r=r.replace("png","svg");c("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":r})}c.each(e,function(){c("#swipebox-slider").append('<div class="slide"></div>')});if(n.settings.fullScreen){var s=a.body;t.requestFullScreen(s)}t.setDim();t.actions();t.keyboard();t.gesture();t.animBars();t.resize()},requestFullScreen:function(r){var s=r.requestFullScreen||r.webkitRequestFullScreen||r.mozRequestFullScreen||r.msRequestFullScreen;if(s){s.call(r)}},exitFullScreen:function(r){var s=a.cancelFullScreen||a.webkitCancelFullScreen||a.mozCancelFullScreen||a.exitFullscreen;if(s){s.call(a)}},setDim:function(){var t,r,s={};if("onorientationchange" in b){b.addEventListener("orientationchange",function(){if(b.orientation==0){t=f;r=i}else{if(b.orientation==90||b.orientation==-90){t=i;r=f}}},false)}else{t=b.innerWidth?b.innerWidth:c(b).width();r=b.innerHeight?b.innerHeight:c(b).height()}s={width:t,height:r};c("#swipebox-overlay").css(s)},resize:function(){var r=this;c(b).resize(function(){r.setDim()}).resize()},supportTransition:function(){var s="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" ");for(var r=0;r<s.length;r++){if(a.createElement("div").style[s[r]]!==d){return s[r]}}return false},doCssTrans:function(){if(n.settings.useCSS&&this.supportTransition()){return true}},gesture:function(){if(k){var v=this,w=null,u=10,t={},r={};var s=c("#swipebox-caption, #swipebox-action");s.addClass("visible-bars");v.setTimeout();c("body").bind("touchstart",function(x){c(this).addClass("touching");r=x.originalEvent.targetTouches[0];t.pageX=x.originalEvent.targetTouches[0].pageX;c(".touching").bind("touchmove",function(y){y.preventDefault();y.stopPropagation();r=y.originalEvent.targetTouches[0]});return false}).bind("touchend",function(x){x.preventDefault();x.stopPropagation();w=r.pageX-t.pageX;if(w>=u){v.getPrev()}else{if(w<=-u){v.getNext()}else{if(!s.hasClass("visible-bars")){v.showBars();v.setTimeout()}else{v.clearTimeout();v.hideBars()}}}c(".touching").unbind("touchmove").removeClass("touching")})}},setTimeout:function(){if(n.settings.hideBarsDelay>0){var r=this;r.clearTimeout();r.timeout=b.setTimeout(function(){r.hideBars()},n.settings.hideBarsDelay)}},clearTimeout:function(){b.clearTimeout(this.timeout);this.timeout=null},setAutoSwipeTimeout:function(){if((!this.paused)&&(n.settings.autoSwipeDelay>0)){var r=this;r.clearAutoSwipeTimeout();r.swipeTimerId=b.setTimeout(function(){r.getNext()},n.settings.autoSwipeDelay)}},clearAutoSwipeTimeout:function(){b.clearTimeout(this.swipeTimerId);this.swipeTimerId=null},showBars:function(){var r=c("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){r.addClass("visible-bars")}else{c("#swipebox-caption").animate({top:0},500);c("#swipebox-action").animate({bottom:0},500);setTimeout(function(){r.addClass("visible-bars")},1000)}},hideBars:function(){var r=c("#swipebox-caption, #swipebox-action");if(this.doCssTrans()){r.removeClass("visible-bars")}else{c("#swipebox-caption").animate({top:"-50px"},500);c("#swipebox-action").animate({bottom:"-50px"},500);setTimeout(function(){r.removeClass("visible-bars")},1000)}},animBars:function(){var s=this;var r=c("#swipebox-caption, #swipebox-action");r.addClass("visible-bars");s.setTimeout();c("#swipebox-slider").click(function(t){if(!r.hasClass("visible-bars")){s.showBars();s.setTimeout()}});c("#swipebox-action").hover(function(){s.showBars();r.addClass("force-visible-bars");s.clearTimeout()},function(){r.removeClass("force-visible-bars");s.setTimeout()})},keyboard:function(){var r=this;c(b).bind("keyup",function(s){s.preventDefault();s.stopPropagation();if(s.keyCode==37){r.getPrev()}else{if(s.keyCode==39){r.getNext()}else{if(s.keyCode==27){r.closeSlide()}}}})},actions:function(){var r=this;if(e.length<2){c("#swipebox-prev, #swipebox-next").hide()}else{c("#swipebox-prev").bind("click touchend",function(s){s.preventDefault();s.stopPropagation();r.getPrev();r.setTimeout()});c("#swipebox-next").bind("click touchend",function(s){s.preventDefault();s.stopPropagation();r.getNext();r.setTimeout()})}c("#swipebox-close").bind("click touchend",function(s){r.closeSlide()});c("#swipebox-play").bind("click touchend",function(s){r.togglePlay()})},setSlide:function(s,r){r=r||false;var t=c("#swipebox-slider");if(this.doCssTrans()){t.css({left:(-s*100)+"%"})}else{t.animate({left:(-s*100)+"%"})}c("#swipebox-slider .slide").removeClass("current");c("#swipebox-slider .slide").eq(s).addClass("current");this.setTitle(s);if(r){t.fadeIn()}this.clearAutoSwipeTimeout();this.setAutoSwipeTimeout();c("#swipebox-prev, #swipebox-next").removeClass("disabled");if(s==0){c("#swipebox-prev").addClass("disabled")}else{if(s==e.length-1){c("#swipebox-next").addClass("disabled");this.clearAutoSwipeTimeout()}}},openSlide:function(r){c("html").addClass("swipebox");c(b).trigger("resize");this.setSlide(r,true)},preloadMedia:function(r){var s=this,t=null;if(e[r]!==d){t=e[r].href}if(!s.isVideo(t)){setTimeout(function(){s.openMedia(r)},1000)}else{s.openMedia(r)}},openMedia:function(r){var s=this,t=null;if(e[r]!==d){t=e[r].href}if(r<0||r>=e.length){return false}if(!s.isVideo(t)){s.loadMedia(t,function(){c("#swipebox-slider .slide").eq(r).html(this)})}else{c("#swipebox-slider .slide").eq(r).html(s.getVideo(t))}s.clearAutoSwipeTimeout();s.setAutoSwipeTimeout()},setTitle:function(s,r){var t=null;c("#swipebox-caption").empty();if(e[s]!==d){t=e[s].title}if(t){c("#swipebox-caption").append(t)}},isVideo:function(r){if(r){if(r.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||r.match(/vimeo\.com\/([0-9]*)/)){return true}}},getVideo:function(t){var u="";var s="";var r=t.match(/watch\?v=([a-zA-Z0-9\-_]+)/);var v=t.match(/vimeo\.com\/([0-9]*)/);if(r){u='<iframe width="560" height="315" src="//www.youtube.com/embed/'+r[1]+'" frameborder="0" allowfullscreen></iframe>'}else{if(v){u='<iframe width="560" height="315"  src="http://player.vimeo.com/video/'+v[1]+"?byline=0&amp;portrait=0&amp;color="+n.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}}return'<div class="swipebox-video-container" style="max-width:'+n.settings.videomaxWidth+'px"><div class="swipebox-video">'+u+"</div></div>"},loadMedia:function(s,t){if(!this.isVideo(s)){var r=c("<img>").bind("load",function(){t.call(r)});r.attr("src",s)}},getNext:function(){var r=this;index=c("#swipebox-slider .slide").index(c("#swipebox-slider .slide.current"));if(index+1<e.length){index++;r.setSlide(index);r.preloadMedia(index+1)}else{c("#swipebox-slider").addClass("rightSpring");setTimeout(function(){c("#swipebox-slider").removeClass("rightSpring")},500)}},getPrev:function(){index=c("#swipebox-slider .slide").index(c("#swipebox-slider .slide.current"));if(index>0){index--;this.setSlide(index);this.preloadMedia(index-1)}else{c("#swipebox-slider").addClass("leftSpring");setTimeout(function(){c("#swipebox-slider").removeClass("leftSpring")},500)}},togglePlay:function(){if(this.paused){this.clearAutoSwipeTimeout();this.setAutoSwipeTimeout();c("#swipebox-action #swipebox-play").removeClass("play-button").addClass("pause-button");this.paused=false}else{this.clearAutoSwipeTimeout();c("#swipebox-action #swipebox-play").removeClass("pause-button").addClass("play-button");this.paused=true}},closeSlide:function(){if(n.settings.fullScreen){this.exitFullScreen()}c("html").removeClass("swipebox");c(b).trigger("resize");this.destroy()},destroy:function(){this.clearAutoSwipeTimeout();c(b).unbind("keyup");c("body").unbind("touchstart");c("body").unbind("touchmove");c("body").unbind("touchend");c("#swipebox-slider").unbind();c("#swipebox-overlay").remove();if(!c.isArray(g)){g.removeData("_swipebox")}if(this.target){this.target.trigger("swipebox-destroy")}c.swipebox.isOpen=false;if(n.settings.afterClose){n.settings.afterClose()}}};n.init()};c.fn.swipebox=function(f){if(!c.data(this,"_swipebox")){var e=new c.swipebox(this,f);this.data("_swipebox",e)}return this.data("_swipebox")}}(window,document,jQuery));